## Description

CVE-2024-48208 is a vulnerability affecting pure-ftpd versions prior to 1.0.52, classified as a buffer overflow due to an out-of-bounds read in the `domlsd()` function within the `ls.c` file [[5]](#References). This vulnerability stems from insufficient boundary checks on the `base` pointer, which fails to verify if the pointer is at the end of the command buffer during execution [[1]](#References). As a result, smartly crafted inputs can lead to access beyond the allocated memory, causing potential memory leaks, unpredictable application behavior, or data corruption [[6]](#References).

The vulnerability has been assigned a CVSS score of 8.6, indicating high severity, primarily due to its network-based attack vector, low complexity, and lack of required privileges or user interaction for exploitation [[8]](#References). While the impacts on confidentiality and integrity are assessed as low, the effect on availability is rated as high, potentially compromising the application's stability [[2]](#References).

Exploitation attempts have been demonstrated using proof-of-concept scripts, indicating that an attacker could leverage this vulnerability [[1]](#References). However, assessments from various organizations suggest a low likelihood of imminent exploitation, with an EPSS score of 0.04% predicting minimal exploitation activity within the upcoming month [[6]](#References). The vulnerability has been linked to CWE-125: Out-of-bounds Read [[3]](#References). A fix has been proposed in a pull request on GitHub, addressing the underlying code issue to mitigate the risk [[7]](#References).

## Affected Versions

- Component: pure-ftpd
    - Affected Versions: before 1.0.52 [[5]](#References)
- Component: pure-ftpd
    - Affected Versions: 1.0.49-4.1 (bullseye), 1.0.50-2.1 (bookworm), 1.0.50-2.2 (sid, trixie) [[4]](#References)

## Unaffected Versions

'- Component: pure-ftpd' - Unaffected Versions: 1.0.52 and later [[5]](#References)'

## Mitigation

- Upgrade to pure-ftpd version 1.0.52 or later to mitigate the vulnerability [[4]](#References)[[6]](#References).
- Apply the patch from Pull Request '176 to fix the out-of-bounds reading issue in the domlsd() function [[1]](#References)[[6]](#References).
- Ensure the base pointer checks for the end of the command buffer before accessing it [[1]](#References).
- Open a support case for prioritizing the release of a fix if needed [[5]](#References).
- Check the Debian security tracker for updates related to this vulnerability [[4]](#References).

## Exploit

CVE-2024-48208 pertains to a buffer overflow vulnerability due to an out-of-bounds read in the 'domlsd()' function of the 'ls.c' file in pure-ftpd versions prior to 1.0.52 [[5]](#References). The exploit involves several steps that an attacker would follow:

1. Identify Target: The attacker first determines if a vulnerable version of the pure-ftpd service (any version before 1.0.52) is running on a server [[8]](#References).
2. Establish Connection: The attacker initiates a TCP connection to the target serverâ€™s IP address on the port used by pure-ftpd [[1]](#References).
3. Authentication: The attacker sends arbitrary credentials to authenticate with the server, using commands like 'USER fuzzing' and 'PASS fuzzing' [[1]](#References).
4. Craft Payload: The attacker prepares a specially crafted network request payload designed to trigger the out-of-bounds read condition. An example payload might look like 'MLSD -'.ljust(4110, b''.') [[6]](#References).
5. Send Exploit: This crafted payload is transmitted to the vulnerable service. The absence of proper bounds checking allows the input to overwrite adjacent memory, which may lead to memory corruption, execution of arbitrary code, or causing a denial of service [[4]](#References).

These actions enable the attacker to manipulate the buffer flow, potentially altering application behavior, leading to security violations such as execution of unauthorized commands or service interruption [[8]](#References).

## Root Cause

The root cause of the buffer overflow vulnerability (CVE-2024-48208) in the `domlsd()` function of the `src/ls.c` file arises from insufficient bounds checking when processing the `base` string [[5]](#References). This issue allows the function to read beyond the allocated memory, resulting in an out-of-bounds read that can lead to memory corruption.\n\nThere are two primary components contributing to this vulnerability:

1. Uncontrolled iteration on the `base` string: The existing logic in the `domlsd()` function attempts to increment the `base` pointer without adequately checking the boundaries of the string. This behavior can lead to accessing memory past the allocated space for `base` if the string does not contain certain characters [[1]](#References).

    The relevant code snippet is from the `domlsd()` function:

    ```c
    if (*base != 0 && chdir(base) != 0) {
        if (*base++ == '-') {
            while (!isspace((unsigned char) *base++));
            while (isspace((unsigned char) *base++));
            if (*base != 0 && chdir(base) != 0) {
                addreply_noformat(550, MSG_STAT_FAILURE2);
                return;
            }
        } else {
            addreply_noformat(550, MSG_STAT_FAILURE2);
            return;
        }
    }
    ```

    In this snippet, the while loops may continue to increment the `base` pointer even when `*base` becomes `0`, leading to unchecked reads [[6]](#References).

2. Lack of proper termination checks: The existing logic does not ensure that the pointer `base` will not graduate beyond its valid range before the check to call `chdir(base)`. The absence of appropriate boundary conditions makes additional reads beyond `base` possible [[8]](#References).

    This is reflected in the same function:

    ```c
    while (!isspace((unsigned char) *base++));
    while (isspace((unsigned char) *base++));
    ```

    Without precautions, this can result in reading memory past the intended buffer. The subsequent potential for returning back to the calling function without valid `base` content can create a state of undefined behavior or trigger other consequences such as system crashes or security issues [[4]](#References).

    This vulnerability thus allows crafted input to trigger memory read operations that can lead to unintended behavior, impacting system availability [[3]](#References).

## References

- [1] https://github.com/jedisct1/pure-ftpd/pull/176
- [2] https://cve.circl.lu/cve/CVE-2024-48208
- [3] https://nvd.nist.gov/vuln/detail/CVE-2024-48208
- [4] https://security-tracker.debian.org/tracker/CVE-2024-48208
- [5] https://access.redhat.com/security/cve/cve-2024-48208
- [6] https://www.cvedetails.com/cve/CVE-2024-48208
- [7] https://storage.googleapis.com/cve-osv-conversion/osv-output/CVE-2024-48208.json
- [8] https://vulners.com/cve/CVE-2024-48208
- [9] https://app.soos.io/research/vulnerabilities/CVE-2024-48208

